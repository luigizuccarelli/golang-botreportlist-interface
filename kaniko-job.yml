apiVersion: batch/v1
kind: Job
metadata:
  name: kaniko-servisbot-s3bucket-manager
spec:
  parallelism: 1    
  completions: 1    
  template:         
    metadata:
      name: kaniko-servisbot-s3bucket-manager
    spec:
      containers:
      - name: kaniko
        image: gcr.io/kaniko-project/executor:latest
        args: [
          "--dockerfile=/godata/pipelines/servisbot-s3bucket-manager/Dockerfile",
          "--context=/godata/pipelines/servisbot-s3bucket-manager",
          "--destination=tfld-docker-prd-local.repo.14west.io/servisbot-s3bucket-manager:1.14.2"
        ]
        volumeMounts:
        - mountPath: /godata
          name: gocdagent-data
        - mountPath: /kaniko/.docker/config.json
          name: docker-creds
          subPath: config.json
        env:
        - name: DESITINATION
          value: tfld-docker-prd-local.repo.14west.io/servisbot-s3bucket-manager:1.14.2 
      restartPolicy: Never   
      volumes:
      - name: gocdagent-data
        persistentVolumeClaim:
          claimName:  gocdagent-node-and-go
      - name: docker-creds
        configMap:
          defaultMode: 420
          name: configcontent
      backoffLimit: 1
